# CNC Winder Klipper Config
# Optimized for pickup coil winding

[mcu pico]
serial: /dev/ttyACM0
restart_method: command

# Main winding motor (pickup coil winding)
[stepper main_winder]
step_pin: pico:gpio0
dir_pin: pico:gpio1  
enable_pin: pico:gpio2
microsteps: 16
rotation_distance: 360  # 360 degrees per revolution
endstop_pin: pico:gpio3

# Pickup arm positioning
[stepper pickup_arm]
step_pin: pico:gpio4
dir_pin: pico:gpio5
enable_pin: pico:gpio6
microsteps: 16
rotation_distance: 40
endstop_pin: pico:gpio7

# Wire feed mechanism  
[stepper wire_feed]
step_pin: pico:gpio8
dir_pin: pico:gpio9
enable_pin: pico:gpio10
microsteps: 16
rotation_distance: 20

# Encoder feedback
[pulse_counter winding_encoder]
pin: pico:gpio11

# Temperature monitoring (optional)
[temperature_sensor pico_temp]
sensor_type: temperature_mcu
sensor_mcu: pico

# Fan control (optional)
[fan pico_fan]
pin: pico:gpio12

# Custom winder commands
[gcode_macro WIND_COIL]
description: Wind a pickup coil
gcode:
    # Home all axes
    G28
    
    # Set winding parameters
    {% set turns = params.TURNS|default(5000)|int %}
    {% set speed = params.SPEED|default(1000)|int %}
    
    # Wind the coil
    M118 Starting coil winding...
    G1 X{turns} F{speed}
    M118 Coil winding complete!

[gcode_macro HOME_ALL]
description: Home all motors
gcode:
    G28 X Y Z

[gcode_macro EMERGENCY_STOP]
description: Emergency stop
gcode:
    M112

